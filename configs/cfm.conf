# Allow incoming TCP ports
TCP_IN = "0:65535"
# Allow outgoing TCP ports
TCP_OUT = "0:65535"
# Allow incoming UDP ports
UDP_IN = "0:65535"
# Allow outgoing UDP ports
# To allow outgoing traceroute add 33434:33523 to this list
UDP_OUT = "0:65535"

#API CONNECTION to CFM WEB
API_URL = "https://cfm.myip.gr"
AUTH_TOKEN = "f4e0b229-eb62-4eda-a5a9-add8e7c08bde"


###############################################################################
# Connection Limit Protection (per-IP concurrent TCP connections per port)
#
# Syntax: port;limit
# Meaning: Allow up to <limit> concurrent TCP connections from the same source IP
#          to the specified destination port.
#
# Notes:
# - Applies to TCP only (as in CSF). UDP is not connection-oriented.
# - Use higher limits on HTTP/HTTPS to avoid blocking browsers/CDNs/crawlers.
# - Mail/IMAP/POP3 typically need only a handful of concurrent sessions.
# - Keep FTP and SSH tight. Do not expose DB ports publicly if possible.
# - Tune with real traffic: check nft counters and increase if you see false hits.
###############################################################################
CONNLIMIT = "80;100,443;100,25;20,465;20,587;20,143;10,993;10,110;8,995;8,21;5,990;5,22;5,3306;5,53;20,65535;50"

###############################################################################
# Port Flood Protection (per-port connection rate limiting)
#
# Syntax: port;protocol;interval_seconds;max_hits
# Meaning: Allow up to <max_hits> new connections per <interval_seconds>
#          from the same source IP, to the specified port/protocol.
#
# Notes:
# - Uses nftables "limit rate" with burst, so short bursts are tolerated.
# - Designed to prevent simple DoS floods without blocking normal users.
# - Keep thresholds higher for HTTP/HTTPS (due to crawlers/CDNs).
# - Use stricter limits for mail, IMAP/POP3, and FTP services.
# - Do not expose DB ports (3306) to the internet; if exposed, keep very strict.
# - DNS can be noisy; adjust higher if this is a public resolver.
###############################################################################
###############################################################################
# Port Flood Protection
# Syntax: port;protocol;interval_seconds;max_hits
# - 80;tcp;60;200  => allow up to 200 new connections per IP to TCP/80 per 60s
# - 25;tcp;60;30   => allow up to 30 new SMTP connections per IP per 60s
# - 143;tcp;60;20  => allow up to 20 new IMAP connections per IP per 60s
# - 993;tcp;60;20  => same for IMAPS
# - 21;tcp;60;10   => FTP limited to 10/min per IP
# - 3306;tcp;60;5  => MySQL very strict (if exposed at all)
# - 53;udp;60;100  => DNS UDP allow 100 queries/min per IP
# - 53;tcp;60;50   => DNS TCP allow 50/min per IP
###############################################################################
PORTFLOOD = "80;tcp;60;200,443;tcp;60;200,25;tcp;60;30,465;tcp;60;30,587;tcp;60;30,143;tcp;60;20,993;tcp;60;20,110;tcp;60;20,995;tcp;60;20,21;tcp;60;10,990;tcp;60;10,3306;tcp;60;5,53;udp;60;100,53;tcp;60;50,65535;tcp;60;50"
# check chain using sudo nft list chain inet cfm flood


###############################################################################
# SECTION: Per-IP Packet Rate Limiting (kernel-only)
###############################################################################
# Limits the packet *rate* per source IP (not concurrent connections).
# If an IP sends packets faster than RATE for a sustained period (respecting BURST),
# excess packets are dropped in-kernel. When the rate drops back, traffic passes again.
#
# This helps against packet floods (e.g. SYN floods, request bursts).
# It does NOT implement temporary/permanent bans or count concurrent connections.
#
# To disable, set RATE to "0".
# packets per second per source IP (0 = disabled)
PKT_RATE = "200"
# burst allowance in packets before drops begin
PKT_BURST = "400"
# "syn" to limit only TCP SYN; "all" to limit all packets
PKT_MODE = "syn"


###############################################################################
# Auto-block από throttling (per-IP)
# Αν μια IP εμφανιστεί >= HITS μέσα σε WINDOW δευτ. σε οποιοδήποτε από τα
# throttled_* sets (syn/pps/portflood), τότε μπαίνει στο deny με TTL & reason.
###############################################################################
# Autoblock policy
THROTTLE_ENABLED = "1"           # 1/0
THROTTLE_WINDOW  = "120"         # sec
THROTTLE_HITS    = "3"           # πόσα throttles μέσα στο window
THROTTLE_MODE    = "permanent"   # "permanent" | "ttl"
THROTTLE_TTL     = "86400"       # sec, αν mode=ttl
THROTTLE_SOURCES = "syn,portflood,pps" # ποιοι μετρητές συνεισφέρουν
THROTTLE_SET_TTL = "120"          # sec, TTL των th_* sets για ομαδοποίηση
